# Codebase Structure

**Analysis Date:** 2026-01-10

## Directory Layout

```
piak-backend/
├── functions/              # Firebase Cloud Functions codebase
│   ├── src/                # TypeScript source code
│   │   └── index.ts        # Entry point, exports functions
│   ├── lib/                # Compiled JavaScript (generated)
│   ├── node_modules/       # Dependencies
│   ├── package.json        # Dependencies and scripts
│   ├── package-lock.json   # Lockfile
│   ├── tsconfig.json       # TypeScript config
│   ├── tsconfig.dev.json   # Dev TypeScript config
│   ├── .eslintrc.js        # ESLint configuration
│   └── .gitignore          # Functions-specific ignores
├── .planning/              # Planning documents
│   └── codebase/           # Codebase analysis (this directory)
├── firestore.rules         # Database security rules
├── firestore.indexes.json  # Database indexes
├── firebase.json           # Firebase project config
├── .firebaserc             # Project ID mapping
├── .gitignore              # Root gitignore
├── CLAUDE.md               # Claude Code instructions
└── specs.md                # Implementation specification
```

## Directory Purposes

**functions/:**
- Purpose: All Cloud Functions code and configuration
- Contains: TypeScript source, compiled output, dependencies
- Key files: `src/index.ts` (entry point), `package.json` (scripts)
- Subdirectories: `src/` (source), `lib/` (compiled)

**functions/src/:**
- Purpose: TypeScript source code
- Contains: Currently only `index.ts` (stub with global config)
- Key files: `index.ts` - exports all functions
- Subdirectories: Planned per `specs.md`:
  - `config/` - Claude API configuration
  - `functions/` - Cloud Function implementations
  - `prompts/` - System prompts for Claude
  - `services/` - API wrappers
  - `types/` - TypeScript interfaces

**functions/lib/:**
- Purpose: Compiled JavaScript output (generated by build)
- Contains: `.js` files and `.js.map` source maps
- Key files: Generated from `src/`
- Subdirectories: Mirrors `src/` structure

**.planning/:**
- Purpose: Project planning and codebase analysis
- Contains: Codebase documents (STACK.md, ARCHITECTURE.md, etc.)
- Key files: Analysis and planning documents

## Key File Locations

**Entry Points:**
- `functions/src/index.ts` - Cloud Functions entry point, global config

**Configuration:**
- `firebase.json` - Firebase project config (emulator ports, predeploy hooks)
- `.firebaserc` - Project ID: `piak-a9b47`
- `functions/tsconfig.json` - TypeScript compiler options
- `functions/.eslintrc.js` - ESLint rules (Google style)

**Core Logic:**
- `functions/src/index.ts` - Currently minimal (stub with imports)
- Planned: `functions/src/functions/*.ts` - Cloud Function implementations
- Planned: `functions/src/services/claudeService.ts` - Claude API wrapper

**Testing:**
- No test files currently exist
- Planned: `functions/src/**/*.test.ts` (co-located)

**Documentation:**
- `CLAUDE.md` - Claude Code instructions
- `specs.md` - Full implementation specification
- `.planning/codebase/` - Codebase analysis documents

## Naming Conventions

**Files:**
- camelCase.ts for TypeScript modules (e.g., `intentClassifier.ts`, `claudeService.ts`)
- kebab-case for config files (e.g., `firebase.json`)
- UPPERCASE.md for documentation (e.g., `CLAUDE.md`, `README.md`)
- .test.ts suffix for test files (planned)

**Directories:**
- lowercase for all directories (e.g., `functions/`, `src/`, `config/`)
- Plural for collections (e.g., `functions/`, `prompts/`, `types/`)
- Singular for specific purposes (e.g., `lib/`, `src/`)

**Special Patterns:**
- `index.ts` for directory exports
- `.eslintrc.js` for ESLint configuration
- `tsconfig.json` and `tsconfig.dev.json` for TypeScript

## Where to Add New Code

**New Cloud Function:**
- Primary code: `functions/src/functions/{functionName}.ts`
- Export in: `functions/src/index.ts`
- Tests: `functions/src/functions/{functionName}.test.ts`

**New Service/Utility:**
- Implementation: `functions/src/services/{serviceName}.ts`
- Types: `functions/src/types/{typeName}.ts`
- Tests: `functions/src/services/{serviceName}.test.ts`

**New System Prompt:**
- Implementation: `functions/src/prompts/{promptName}.ts`
- No tests needed (pure data)

**Configuration:**
- API config: `functions/src/config/{configName}.ts`
- Environment: `functions/.env` (local) or Firebase config (production)

## Special Directories

**functions/lib/:**
- Purpose: Generated JavaScript (compiled from TypeScript)
- Source: Built by `npm run build`
- Committed: No (in .gitignore)

**functions/node_modules/:**
- Purpose: npm dependencies
- Source: Installed by `npm install`
- Committed: No (in .gitignore)

**.firebase/:**
- Purpose: Firebase cache and deployment artifacts
- Source: Generated by Firebase CLI
- Committed: No (in .gitignore)

---

*Structure analysis: 2026-01-10*
*Update when directory structure changes*
