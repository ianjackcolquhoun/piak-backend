# Milestone v1.0: MVP

**Status:** SHIPPED 2026-01-12
**Phases:** 1-5
**Total Plans:** 8

## Overview

Build an AI-powered contact organizer backend that parses natural language notes into structured contact data. Starting with Claude API integration, then building intent classification, contact extraction, CRUD operations, and finally security hardening. The core challenge is accurate extraction from casual/abbreviated input.

## Phases

### Phase 1: Foundation

**Goal**: Establish Claude API integration service and contact data model in Firestore
**Depends on**: Nothing (first phase)
**Plans**: 2 plans

Plans:
- [x] 01-01: Claude API service with Haiku 4.5
- [x] 01-02: Contact data model and Firestore schema

**Details:**
- Installed @anthropic-ai/sdk v0.71.2
- Created ClaudeService class with complete() method
- Added testClaude onCall function for verification
- Contact interface with dual raw+structured approach
- ContactData with 10 optional fields for AI extraction
- Input types for create/update/search operations

### Phase 2: Intent Classification

**Goal**: Classify user input as add/update/search operation and route accordingly
**Depends on**: Phase 1
**Plans**: 1 plan

Plans:
- [x] 02-01: Intent classification function and routing logic

**Details:**
- Intent type definitions (Intent, Confidence, ClassifyIntentInput, ClassifyIntentResponse)
- System prompt with clear examples for add/update/search classification
- classifyIntent onCall function with authentication and error handling
- JSON-only response parsing with validation
- 256 maxTokens for classification (short responses)

### Phase 3: Contact Extraction

**Goal**: Parse natural language notes into structured contact data (the core AI feature)
**Depends on**: Phase 2
**Plans**: 1 plan

Plans:
- [x] 03-01: Contact extraction function and system prompts (includes voice-to-text and typed shorthand handling)

**Details:**
- CONTACT_EXTRACTION_PROMPT for parsing both voice-to-text and typed shorthand
- extractContact onCall function following classifyIntent pattern
- 512 maxTokens for extraction (longer responses than classification)

### Phase 4: Contact Operations

**Goal**: Implement contact update and search functions
**Depends on**: Phase 3
**Plans**: 2 plans

Plans:
- [x] 04-01: Contact update function (modify existing contacts)
- [x] 04-02: Search function (find by any fragment)

**Details:**
- updateContact onCall function with ownership verification
- Conditional re-extraction when rawNote changes
- Manual overrides merge on top of extracted data
- searchContacts with AI-powered semantic/fuzzy matching
- Return empty results when no contacts (skip API call)

### Phase 5: Security & Polish

**Goal**: Lock down Firestore rules and refine extraction accuracy
**Depends on**: Phase 4
**Plans**: 2 plans

Plans:
- [x] 05-01: Firestore security rules (user data isolation)
- [x] 05-02: System prompt iteration for edge cases

**Details:**
- Owner-based Firestore security rules for contacts collection
- isOwner() helper function pattern for future collections
- userId field immutable on update (prevents ownership transfer)
- Enhanced extraction prompt with 5 edge case rules
- Multiple people, company vs location, partial names, time references, pronouns

---

## Milestone Summary

**Key Decisions:**

- Hardcoded Haiku 4.5 model per PROJECT.md constraint
- API key injected via defineSecret for Firebase secret management
- 60s timeout configured for Firebase Functions compatibility
- All ContactData fields optional (AI extraction may not find everything)
- rawNote always preserved (never lose original input)
- Separate input types for create/update/search operations
- 256 maxTokens for classification, 512 for extraction/search
- System prompts in prompts/ directory
- Re-extraction only when rawNote actually changes
- Overrides applied after re-extraction (manual edits win)
- Firebase Admin initialized once at module level
- isOwner() helper function for reusable auth checks
- userId field immutable on update (prevents ownership transfer)
- Primary contact = first person or main subject
- Context clues for company vs location ("works at" vs "met at")
- Partial names valid - don't invent last names

**Issues Resolved:**

- Pre-existing lint errors (unused imports, object-curly-spacing)
- Line length lint errors in prompts
- Missing graphql peer dependency for firebase-functions

**Issues Deferred:**

- Firebase Cloud Build deployment cache issue (infrastructure, not code)

**Technical Debt Incurred:**

- None identified

---

_For current project status, see .planning/ROADMAP.md_
